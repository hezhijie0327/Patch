From 926341cf8f35dd33562696b107e5902f5fba446b Mon Sep 17 00:00:00 2001
From: Zhijie He <hezhijie0327@hotmail.com>
Date: Sat, 28 Aug 2021 12:10:21 +0800
Subject: [PATCH] Change the default configuration template

---
 internal/dnsforward/dnsforward.go |   8 ++---
 internal/home/config.go           |  52 +++++++++++++++---------------
 internal/home/filter.go           |   2 --
 3 files changed, 30 insertions(+), 32 deletions(-)

diff --git a/internal/dnsforward/dnsforward.go b/internal/dnsforward/dnsforward.go
index 6f9246b..c5c5e4b 100644
--- a/internal/dnsforward/dnsforward.go
+++ b/internal/dnsforward/dnsforward.go
@@ -26,7 +26,7 @@ import (
 )
 
 // DefaultTimeout is the default upstream timeout
-const DefaultTimeout = 10 * time.Second
+const DefaultTimeout = 1 * time.Second
 
 // defaultClientIDCacheCount is the default count of items in the LRU client ID
 // cache.  The assumption here is that there won't be more than this many
@@ -39,12 +39,12 @@ const (
 )
 
 var defaultDNS = []string{
-	"https://dns10.quad9.net/dns-query",
+	"https://dns.alidns.com:443/dns-query",
 }
-var defaultBootstrap = []string{"9.9.9.10", "149.112.112.10", "2620:fe::10", "2620:fe::fe:10"}
+var defaultBootstrap = []string{"223.5.5.5", "223.6.6.6", "2400:3200::1", "2400:3200:baba::1"}
 
 // Often requested by all kinds of DNS probes
-var defaultBlockedHosts = []string{"version.bind", "id.server", "hostname.bind"}
+var defaultBlockedHosts = []string{"|hostname.bind^", "|id.server^", "|version.bind^", "|version.server^"}
 
 var webRegistered bool
 
diff --git a/internal/home/config.go b/internal/home/config.go
index 710a582..c2b2985 100644
--- a/internal/home/config.go
+++ b/internal/home/config.go
@@ -167,19 +167,19 @@ var config = configuration{
 	BindPort:     3000,
 	BetaBindPort: 0,
 	BindHost:     net.IP{0, 0, 0, 0},
-	AuthAttempts: 5,
-	AuthBlockMin: 15,
+	AuthAttempts: 3,
+	AuthBlockMin: 60,
 	DNS: dnsConfig{
 		BindHosts:     []net.IP{{0, 0, 0, 0}},
 		Port:          53,
 		StatsInterval: 1,
 		FilteringConfig: dnsforward.FilteringConfig{
 			ProtectionEnabled:  true,      // whether or not use any of filtering features
-			BlockingMode:       "default", // mode how to answer filtered requests
-			BlockedResponseTTL: 10,        // in seconds
-			Ratelimit:          20,
+			BlockingMode:       "refused", // mode how to answer filtered requests
+			BlockedResponseTTL: 3600,        // in seconds
+			Ratelimit:          1000,
 			RefuseAny:          true,
-			AllServers:         false,
+			AllServers:         true,
 			FastestTimeout: aghtime.Duration{
 				Duration: fastip.DefaultPingWaitTimeout,
 			},
@@ -190,10 +190,10 @@ var config = configuration{
 			// we introduced a default limit due to this:
 			// https://github.com/AdguardTeam/AdGuardHome/issues/2015#issuecomment-674041912
 			// was later increased to 300 due to https://github.com/AdguardTeam/AdGuardHome/issues/2257
-			MaxGoroutines: 300,
+			MaxGoroutines: 1000,
 		},
-		FilteringEnabled:           true, // whether or not use filter lists
-		FiltersUpdateIntervalHours: 24,
+		FilteringEnabled:           false, // whether or not use filter lists
+		FiltersUpdateIntervalHours: 1,
 		UpstreamTimeout:            aghtime.Duration{Duration: dnsforward.DefaultTimeout},
 		LocalDomainName:            "lan",
 		ResolveClients:             true,
@@ -202,14 +202,14 @@ var config = configuration{
 	TLS: tlsConfigSettings{
 		PortHTTPS:       443,
 		PortDNSOverTLS:  853, // needs to be passed through to dnsproxy
-		PortDNSOverQUIC: 784,
+		PortDNSOverQUIC: 8853,
 	},
 	logSettings: logSettings{
-		LogCompress:   false,
-		LogLocalTime:  false,
-		LogMaxBackups: 0,
-		LogMaxSize:    100,
-		LogMaxAge:     3,
+		LogCompress:   true,
+		LogLocalTime:  true,
+		LogMaxBackups: 3,
+		LogMaxSize:    64,
+		LogMaxAge:     7,
 	},
 	OSConfig:      &osConfig{},
 	SchemaVersion: currentSchemaVersion,
@@ -217,23 +217,23 @@ var config = configuration{
 
 // initConfig initializes default configuration for the current OS&ARCH
 func initConfig() {
-	config.WebSessionTTLHours = 30 * 24
+	config.WebSessionTTLHours = 1
 
 	config.DNS.QueryLogEnabled = true
 	config.DNS.QueryLogFileEnabled = true
-	config.DNS.QueryLogInterval = aghtime.Duration{Duration: 90 * 24 * time.Hour}
-	config.DNS.QueryLogMemSize = 1000
-
-	config.DNS.CacheSize = 4 * 1024 * 1024
-	config.DNS.DnsfilterConf.SafeBrowsingCacheSize = 1 * 1024 * 1024
-	config.DNS.DnsfilterConf.SafeSearchCacheSize = 1 * 1024 * 1024
-	config.DNS.DnsfilterConf.ParentalCacheSize = 1 * 1024 * 1024
-	config.DNS.DnsfilterConf.CacheTime = 30
+	config.DNS.QueryLogInterval = aghtime.Duration{Duration: 7 * 24 * time.Hour}
+	config.DNS.QueryLogMemSize = 0
+
+	config.DNS.CacheSize = 64 * 1024 * 1024
+	config.DNS.DnsfilterConf.SafeBrowsingCacheSize = 64 * 1024 * 1024
+	config.DNS.DnsfilterConf.SafeSearchCacheSize = 64 * 1024 * 1024
+	config.DNS.DnsfilterConf.ParentalCacheSize = 64 * 1024 * 1024
+	config.DNS.DnsfilterConf.CacheTime = 3600
 	config.Filters = defaultFilters()
 
-	config.DHCP.Conf4.LeaseDuration = 86400
+	config.DHCP.Conf4.LeaseDuration = 3600
 	config.DHCP.Conf4.ICMPTimeout = 1000
-	config.DHCP.Conf6.LeaseDuration = 86400
+	config.DHCP.Conf6.LeaseDuration = 3600
 
 	if ch := version.Channel(); ch == version.ChannelEdge || ch == version.ChannelDevelopment {
 		config.BetaBindPort = 3001
diff --git a/internal/home/filter.go b/internal/home/filter.go
index 03965fb..58d263d 100644
--- a/internal/home/filter.go
+++ b/internal/home/filter.go
@@ -57,8 +57,6 @@ func (f *Filtering) Close() {
 
 func defaultFilters() []filter {
 	return []filter{
-		{Filter: filtering.Filter{ID: 1}, Enabled: true, URL: "https://adguardteam.github.io/AdGuardSDNSFilter/Filters/filter.txt", Name: "AdGuard DNS filter"},
-		{Filter: filtering.Filter{ID: 2}, Enabled: false, URL: "https://adaway.org/hosts.txt", Name: "AdAway Default Blocklist"},
 	}
 }
 
-- 
2.33.0

