From 7f7eab1ff899ea76933851e2c74531d04b49bbef Mon Sep 17 00:00:00 2001
From: Zhijie He <hezhijie0327@hotmail.com>
Date: Sat, 18 Sep 2021 16:01:34 +0800
Subject: [PATCH] Change the default configuration template

---
 internal/dnsforward/dnsforward.go |  8 ++---
 internal/home/config.go           | 50 +++++++++++++++----------------
 internal/home/dns.go              |  2 +-
 internal/home/filter.go           |  5 +---
 4 files changed, 31 insertions(+), 34 deletions(-)

diff --git a/internal/dnsforward/dnsforward.go b/internal/dnsforward/dnsforward.go
index 80d5154..53941ec 100644
--- a/internal/dnsforward/dnsforward.go
+++ b/internal/dnsforward/dnsforward.go
@@ -26,7 +26,7 @@ import (
 )
 
 // DefaultTimeout is the default upstream timeout
-const DefaultTimeout = 10 * time.Second
+const DefaultTimeout = 1 * time.Second
 
 // defaultClientIDCacheCount is the default count of items in the LRU client ID
 // cache.  The assumption here is that there won't be more than this many
@@ -39,12 +39,12 @@ const (
 )
 
 var defaultDNS = []string{
-	"https://dns10.quad9.net/dns-query",
+	"https://dns.alidns.com:443/dns-query",
 }
-var defaultBootstrap = []string{"9.9.9.10", "149.112.112.10", "2620:fe::10", "2620:fe::fe:10"}
+var defaultBootstrap = []string{"tls://[223.5.5.5]:53", "tls://[223.6.6.6]:53", "tls://[2400:3200::1]:53", "tls://[2400:3200:baba::1]:53"}
 
 // Often requested by all kinds of DNS probes
-var defaultBlockedHosts = []string{"version.bind", "id.server", "hostname.bind"}
+var defaultBlockedHosts = []string{"|hostname.bind^", "|id.server^", "|version.bind^", "|version.server^"}
 
 var webRegistered bool
 
diff --git a/internal/home/config.go b/internal/home/config.go
index f7cbd0b..301804a 100644
--- a/internal/home/config.go
+++ b/internal/home/config.go
@@ -169,19 +169,19 @@ var config = &configuration{
 	BindPort:     3000,
 	BetaBindPort: 0,
 	BindHost:     net.IP{0, 0, 0, 0},
-	AuthAttempts: 5,
-	AuthBlockMin: 15,
+	AuthAttempts: 3,
+	AuthBlockMin: 60,
 	DNS: dnsConfig{
 		BindHosts:     []net.IP{{0, 0, 0, 0}},
 		Port:          defaultPortDNS,
 		StatsInterval: 1,
 		FilteringConfig: dnsforward.FilteringConfig{
 			ProtectionEnabled:  true,      // whether or not use any of filtering features
-			BlockingMode:       "default", // mode how to answer filtered requests
-			BlockedResponseTTL: 10,        // in seconds
-			Ratelimit:          20,
+			BlockingMode:       "refused", // mode how to answer filtered requests
+			BlockedResponseTTL: 3600,        // in seconds
+			Ratelimit:          1000,
 			RefuseAny:          true,
-			AllServers:         false,
+			AllServers:         true,
 			FastestTimeout: aghtime.Duration{
 				Duration: fastip.DefaultPingWaitTimeout,
 			},
@@ -192,10 +192,10 @@ var config = &configuration{
 			// we introduced a default limit due to this:
 			// https://github.com/AdguardTeam/AdGuardHome/issues/2015#issuecomment-674041912
 			// was later increased to 300 due to https://github.com/AdguardTeam/AdGuardHome/issues/2257
-			MaxGoroutines: 300,
+			MaxGoroutines: 1000,
 		},
-		FilteringEnabled:           true, // whether or not use filter lists
-		FiltersUpdateIntervalHours: 24,
+		FilteringEnabled:           false, // whether or not use filter lists
+		FiltersUpdateIntervalHours: 1,
 		UpstreamTimeout:            aghtime.Duration{Duration: dnsforward.DefaultTimeout},
 		LocalDomainName:            "lan",
 		ResolveClients:             true,
@@ -207,11 +207,11 @@ var config = &configuration{
 		PortDNSOverQUIC: defaultPortQUIC,
 	},
 	logSettings: logSettings{
-		LogCompress:   false,
-		LogLocalTime:  false,
-		LogMaxBackups: 0,
-		LogMaxSize:    100,
-		LogMaxAge:     3,
+		LogCompress:   true,
+		LogLocalTime:  true,
+		LogMaxBackups: 3,
+		LogMaxSize:    64,
+		LogMaxAge:     7,
 	},
 	OSConfig:      &osConfig{},
 	SchemaVersion: currentSchemaVersion,
@@ -219,23 +219,23 @@ var config = &configuration{
 
 // initConfig initializes default configuration for the current OS&ARCH
 func initConfig() {
-	config.WebSessionTTLHours = 30 * 24
+	config.WebSessionTTLHours = 1
 
 	config.DNS.QueryLogEnabled = true
 	config.DNS.QueryLogFileEnabled = true
-	config.DNS.QueryLogInterval = aghtime.Duration{Duration: 90 * 24 * time.Hour}
-	config.DNS.QueryLogMemSize = 1000
-
-	config.DNS.CacheSize = 4 * 1024 * 1024
-	config.DNS.DnsfilterConf.SafeBrowsingCacheSize = 1 * 1024 * 1024
-	config.DNS.DnsfilterConf.SafeSearchCacheSize = 1 * 1024 * 1024
-	config.DNS.DnsfilterConf.ParentalCacheSize = 1 * 1024 * 1024
-	config.DNS.DnsfilterConf.CacheTime = 30
+	config.DNS.QueryLogInterval = aghtime.Duration{Duration: 7 * 24 * time.Hour}
+	config.DNS.QueryLogMemSize = 0
+
+	config.DNS.CacheSize = 64 * 1024 * 1024
+	config.DNS.DnsfilterConf.SafeBrowsingCacheSize = 64 * 1024 * 1024
+	config.DNS.DnsfilterConf.SafeSearchCacheSize = 64 * 1024 * 1024
+	config.DNS.DnsfilterConf.ParentalCacheSize = 64 * 1024 * 1024
+	config.DNS.DnsfilterConf.CacheTime = 3600
 	config.Filters = defaultFilters()
 
-	config.DHCP.Conf4.LeaseDuration = 86400
+	config.DHCP.Conf4.LeaseDuration = 3600
 	config.DHCP.Conf4.ICMPTimeout = 1000
-	config.DHCP.Conf6.LeaseDuration = 86400
+	config.DHCP.Conf6.LeaseDuration = 3600
 
 	if ch := version.Channel(); ch == version.ChannelEdge || ch == version.ChannelDevelopment {
 		config.BetaBindPort = 3001
diff --git a/internal/home/dns.go b/internal/home/dns.go
index 4b12058..78d3b9d 100644
--- a/internal/home/dns.go
+++ b/internal/home/dns.go
@@ -24,7 +24,7 @@ const (
 	defaultPortDNS   = 53
 	defaultPortHTTP  = 80
 	defaultPortHTTPS = 443
-	defaultPortQUIC  = 784
+	defaultPortQUIC  = 8853
 	defaultPortTLS   = 853
 )
 
diff --git a/internal/home/filter.go b/internal/home/filter.go
index 22bc743..e8e596e 100644
--- a/internal/home/filter.go
+++ b/internal/home/filter.go
@@ -57,10 +57,7 @@ func (f *Filtering) Close() {
 }
 
 func defaultFilters() []filter {
-	return []filter{
-		{Filter: filtering.Filter{ID: 1}, Enabled: true, URL: "https://adguardteam.github.io/AdGuardSDNSFilter/Filters/filter.txt", Name: "AdGuard DNS filter"},
-		{Filter: filtering.Filter{ID: 2}, Enabled: false, URL: "https://adaway.org/hosts.txt", Name: "AdAway Default Blocklist"},
-	}
+	return []filter{}
 }
 
 // field ordering is important -- yaml fields will mirror ordering from here
-- 
2.25.1
